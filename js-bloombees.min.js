!function(e){var o=!1;if("function"==typeof define&&define.amd&&(define(e),o=!0),"object"==typeof exports&&(module.exports=e(),o=!0),!o){var r=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=r,t}}}(function(){function e(){for(var e=0,o={};e<arguments.length;e++){var r=arguments[e];for(var t in r)o[t]=r[t]}return o}function o(r){function t(o,s,i){var n;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},t.defaults,i),"number"==typeof i.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():"";try{n=JSON.stringify(s),/^[\{\[]/.test(n)&&(s=n)}catch(e){}s=r.write?r.write(s,o):encodeURIComponent(String(s)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),o=encodeURIComponent(String(o)),o=o.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),o=o.replace(/[\(\)]/g,escape);var u="";for(var l in i)i[l]&&(u+="; "+l,!0!==i[l]&&(u+="="+i[l]));return document.cookie=o+"="+s+u}o||(n={});for(var c=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,h=0;h<c.length;h++){var g=c[h].split("="),m=g.slice(1).join("=");'"'===m.charAt(0)&&(m=m.slice(1,-1));try{var f=g[0].replace(d,decodeURIComponent);if(m=r.read?r.read(m,f):r(m,f)||m.replace(d,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(e){}if(o===f){n=m;break}o||(n[f]=m)}catch(e){}}return n}}return t.set=t,t.get=function(e){return t.call(t,e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(o,r){t(o,"",e(r,{expires:-1}))},t.withConverter=o,t}return o(function(){})});var LZString=function(){function e(e,o){if(!s[e]){s[e]={};for(var r=0;r<e.length;r++)s[e][e.charAt(r)]=r}return s[e][o]}var o=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={},i={compressToBase64:function(e){if(null==e)return"";var o=i._compress(e,6,function(e){return r.charAt(e)});switch(o.length%4){default:case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(o){return null==o?"":""==o?null:i._decompress(o.length,32,function(t){return e(r,o.charAt(t))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return o(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(o){return e.charCodeAt(o)-32})},compressToUint8Array:function(e){for(var o=i.compress(e),r=new Uint8Array(2*o.length),t=0,s=o.length;t<s;t++){var n=o.charCodeAt(t);r[2*t]=n>>>8,r[2*t+1]=n%256}return r},decompressFromUint8Array:function(e){if(null===e||void 0===e)return i.decompress(e);for(var r=new Array(e.length/2),t=0,s=r.length;t<s;t++)r[t]=256*e[2*t]+e[2*t+1];var n=[];return r.forEach(function(e){n.push(o(e))}),i.decompress(n.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return t.charAt(e)})},decompressFromEncodedURIComponent:function(o){return null==o?"":""==o?null:(o=o.replace(/ /g,"+"),i._decompress(o.length,32,function(r){return e(t,o.charAt(r))}))},compress:function(e){return i._compress(e,16,function(e){return o(e)})},_compress:function(e,o,r){if(null==e)return"";var t,s,i,n={},a={},u="",l="",c="",d=2,h=3,g=2,m=[],f=0,b=0;for(i=0;i<e.length;i+=1)if(u=e.charAt(i),Object.prototype.hasOwnProperty.call(n,u)||(n[u]=h++,a[u]=!0),l=c+u,Object.prototype.hasOwnProperty.call(n,l))c=l;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(t=0;t<g;t++)f<<=1,b==o-1?(b=0,m.push(r(f)),f=0):b++;for(s=c.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1}else{for(s=1,t=0;t<g;t++)f=f<<1|s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s=0;for(s=c.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1}d--,0==d&&(d=Math.pow(2,g),g++),delete a[c]}else for(s=n[c],t=0;t<g;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1;d--,0==d&&(d=Math.pow(2,g),g++),n[l]=h++,c=String(u)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(t=0;t<g;t++)f<<=1,b==o-1?(b=0,m.push(r(f)),f=0):b++;for(s=c.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1}else{for(s=1,t=0;t<g;t++)f=f<<1|s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s=0;for(s=c.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1}d--,0==d&&(d=Math.pow(2,g),g++),delete a[c]}else for(s=n[c],t=0;t<g;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1;d--,0==d&&(d=Math.pow(2,g),g++)}for(s=2,t=0;t<g;t++)f=f<<1|1&s,b==o-1?(b=0,m.push(r(f)),f=0):b++,s>>=1;for(;;){if(f<<=1,b==o-1){m.push(r(f));break}b++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(o){return e.charCodeAt(o)})},_decompress:function(e,r,t){var s,i,n,a,u,l,c,d=[],h=4,g=4,m=3,f="",b=[],p={val:t(0),position:r,index:1};for(s=0;s<3;s+=1)d[s]=s;for(n=0,u=Math.pow(2,2),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;switch(n){case 0:for(n=0,u=Math.pow(2,8),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;c=o(n);break;case 1:for(n=0,u=Math.pow(2,16),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;c=o(n);break;case 2:return""}for(d[3]=c,i=c,b.push(c);;){if(p.index>e)return"";for(n=0,u=Math.pow(2,m),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;switch(c=n){case 0:for(n=0,u=Math.pow(2,8),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;d[g++]=o(n),c=g-1,h--;break;case 1:for(n=0,u=Math.pow(2,16),l=1;l!=u;)a=p.val&p.position,p.position>>=1,0==p.position&&(p.position=r,p.val=t(p.index++)),n|=(a>0?1:0)*l,l<<=1;d[g++]=o(n),c=g-1,h--;break;case 2:return b.join("")}if(0==h&&(h=Math.pow(2,m),m++),d[c])f=d[c];else{if(c!==g)return null;f=i+i.charAt(0)}b.push(f),d[g++]=i+f.charAt(0),h--,i=f,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString),function(e){"use strict";function o(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function t(e){var o={next:function(){var o=e.shift();return{done:void 0===o,value:o}}};return p.iterable&&(o[Symbol.iterator]=function(){return o}),o}function s(e){this.map={},e instanceof s?e.forEach(function(e,o){this.append(o,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(o){this.append(o,e[o])},this)}function i(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function n(e){return new Promise(function(o,r){e.onload=function(){o(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var o=new FileReader,r=n(o);return o.readAsArrayBuffer(e),r}function u(e){var o=new FileReader,r=n(o);return o.readAsText(e),r}function l(e){for(var o=new Uint8Array(e),r=new Array(o.length),t=0;t<o.length;t++)r[t]=String.fromCharCode(o[t]);return r.join("")}function c(e){if(e.slice)return e.slice(0);var o=new Uint8Array(e.byteLength);return o.set(new Uint8Array(e)),o.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(p.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(p.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(p.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(p.arrayBuffer&&p.blob&&y(e))this._bodyArrayBuffer=c(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!v(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(l(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var o=e.toUpperCase();return k.indexOf(o)>-1?o:e}function g(e,o){o=o||{};var r=o.body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,o.headers||(this.headers=new s(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=o.credentials||this.credentials||"omit",!o.headers&&this.headers||(this.headers=new s(o.headers)),this.method=h(o.method||this.method||"GET"),this.mode=o.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function m(e){var o=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),t=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");o.append(decodeURIComponent(t),decodeURIComponent(s))}}),o}function f(e){var o=new s;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),t=r.shift().trim();if(t){var s=r.join(":").trim();o.append(t,s)}}),o}function b(e,o){o||(o={}),this.type="default",this.status="status"in o?o.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in o?o.statusText:"OK",this.headers=new s(o.headers),this.url=o.url||"",this._initBody(e)}if(!e.fetch){var p={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(p.arrayBuffer)var C=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(e){return e&&DataView.prototype.isPrototypeOf(e)},v=ArrayBuffer.isView||function(e){return e&&C.indexOf(Object.prototype.toString.call(e))>-1};s.prototype.append=function(e,t){e=o(e),t=r(t);var s=this.map[e];this.map[e]=s?s+","+t:t},s.prototype.delete=function(e){delete this.map[o(e)]},s.prototype.get=function(e){return e=o(e),this.has(e)?this.map[e]:null},s.prototype.has=function(e){return this.map.hasOwnProperty(o(e))},s.prototype.set=function(e,t){this.map[o(e)]=r(t)},s.prototype.forEach=function(e,o){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(o,this.map[r],r,this)},s.prototype.keys=function(){var e=[];return this.forEach(function(o,r){e.push(r)}),t(e)},s.prototype.values=function(){var e=[];return this.forEach(function(o){e.push(o)}),t(e)},s.prototype.entries=function(){var e=[];return this.forEach(function(o,r){e.push([r,o])}),t(e)},p.iterable&&(s.prototype[Symbol.iterator]=s.prototype.entries);var k=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},d.call(g.prototype),d.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new s(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var B=[301,302,303,307,308];b.redirect=function(e,o){if(-1===B.indexOf(o))throw new RangeError("Invalid status code");return new b(null,{status:o,headers:{location:e}})},e.Headers=s,e.Request=g,e.Response=b,e.fetch=function(e,o){return new Promise(function(r,t){var s=new g(e,o),i=new XMLHttpRequest;i.onload=function(){var e={status:i.status,statusText:i.statusText,headers:f(i.getAllResponseHeaders()||"")};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var o="response"in i?i.response:i.responseText;r(new b(o,e))},i.onerror=function(){t(new TypeError("Network request failed"))},i.ontimeout=function(){t(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&p.blob&&(i.responseType="blob"),s.headers.forEach(function(e,o){i.setRequestHeader(o,e)}),i.send(void 0===s._bodyInit?null:s._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),Core=new function(){this.version="1.2.0",this.debug=!1,this.authActive=!1,this.authCookieName="cfauth",this.url=new function(){this.params=function(e){var o=window.location.pathname.split("/");return o.shift(),void 0===e?o:o[e]?o[e]:null},this.formParams=function(e){if(void 0===e){var o=new RegExp("[?&](.*)").exec(window.location.href);return null==o?"":o[1]||0}var o=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==o?null!=(o=new RegExp("[?&]("+e+")[&#$]*").exec(window.location.href))||null:o[1]||""},this.parts=function(e){return void 0===e?window.location:window.location[e]}},this.log=new function(){this.debug=!0,this.type="console",this.printDebug=function(e,o,r){Core.log.debug&&Core.log.print("[DEBUG] "+e,o,r)},this.print=function(e,o,r){if(void 0===e&&(e="print:"),void 0===o&&(o=!1),"console"==Core.log.type)"object"==typeof e&&(e=JSON.parse(JSON.stringify(e))),"object"==typeof o&&(o=JSON.parse(JSON.stringify(o))),console.log(e),o&&console.log(o);else{"object"==typeof e&&(e=JSON.stringify(e)),"object"==typeof o&&(o=JSON.stringify(o)),void 0===r&&(r=!1);var t=e;o&&(t+=o),r&&(t+="\n-----------\n"),null!=(element=document.getElementById(Core.log.type))?element.innerHTML=element.innerHTML+t:(console.log("Core.log.type values "+Core.log.type+" and it does not exist as a id dom"),console.log(t))}}},this.error=new function(){this.add=function(e,o,r){void 0===e?e="[Core.error]:":"string"==typeof e&&(e="[Core.error]: "+e),Core.log.print(e,o,!0)}},this.data=new function(){this.info={},this.add=function(e){if(Core.debug&&Core.log.printDebug("Core.data.add("+JSON.stringify(varname)+");"),"object"!=typeof e)return Core.error.add("Core.data.add(data)","data is not an object"),!1;for(k in e)Core.data.info[k]=e[k];return!0},this.set=function(e,o){return Core.debug&&Core.log.printDebug('Core.data.set("'+e+'",'+JSON.stringify(o)+");"),"string"!=typeof e?(Core.error.add("Core.data.set(key,value)","key is not a string"),!1):(Core.data.info[e]=o,!0)},this.get=function(e){if(Core.debug&&Core.log.printDebug('Core.data.get("'+e+'");'),void 0!==e)return Core.data.info[e]},this.reset=function(){Core.data.info={}}},this.cookies=new function(){this.path={path:"/"},this.remove=function(e){void 0!==e&&(Cookies.remove(e,Core.cookies.path),Core.debug&&Core.log.printDebug('Core.cookies.remove("'+e+'");'))},this.set=function(e,o){Cookies.set(e,o,Core.cookies.path),Core.debug&&Core.log.printDebug('Core.cookies.set("'+e+'","'+o+'");')},this.get=function(e){return Cookies.get(e)}},this.cache=new function(){this.isAvailable=!0,"undefined"==typeof Storage&&(Core.error.add("Cache is not supported in this browser"),this.available=!1),this.set=function(e,o){return Core.debug&&Core.log.printDebug('Core.cache.set("'+e+'",'+JSON.stringify(o)+")"),!!Core.cache.isAvailable&&(e="CloudFrameWorkCache_"+e,o="object"==typeof o?JSON.stringify(o):JSON.stringify({__object:o}),o=LZString.compress(o),localStorage.setItem(e,o),!0)},this.get=function(e){if(Core.debug&&Core.log.printDebug('Core.cache.get("'+e+'")'),Core.cache.isAvailable){e="CloudFrameWorkCache_"+e;var o=localStorage.getItem(e);return void 0!=typeof o&&null!=o&&(o=JSON.parse(LZString.decompress(o)),void 0!==o.__object&&(o=o.__object)),o}return!1},this.delete=function(e){return Core.debug&&Core.log.printDebug('Core.cache.delete("'+e+'",..)'),!!Core.cache.isAvailable&&(e="CloudFrameWorkCache_"+e,localStorage.removeItem(e),!0)}},this.request=new function(){this.token="",this.key="",this.headers={},this.base="https://cloudframework.com/h/api",this.serialize=function(e,o){var r,t=[];for(r in e)if(e.hasOwnProperty(r)){var s=o?o+"["+r+"]":r,i=e[r];t.push(null!==i&&"object"==typeof i?Core.request.serialize(i,s):encodeURIComponent(s)+"="+encodeURIComponent(i))}return t.join("&")},this.call=function(e,o,r){if(void 0===e.url)return Core.error.add('request.call(payload,..): missing payload["url"].');void 0===e.method&&(e.method="GET"),void 0===e.responseType&&(e.responseType="json"),void 0===e.base&&(e.base=Core.request.base),void 0!==o&&null!=o||(o=function(e){console.log(e)}),void 0!==r&&null!=r||(r=o),void 0===e.headers&&(e.headers={});for(var t in Core.request.headers)void 0===e.headers[t]&&(e.headers[t]=Core.request.headers[t]);void 0!==Core.request.token&&""!=Core.request.token&&(e.headers["X-DS-TOKEN"]=Core.request.token),void 0!==Core.request.key&&""!=Core.request.key&&(e.headers["X-WEB-KEY"]=Core.request.key);var s=e.url;if(0!==s.search("http")&&(s=e.base+s),void 0===e.mode||"cors"!=e.mode&&"no-cors"!=e.mode&&"same-origin"!=e.mode&&(e.credentials="cors"),void 0===e.credentials||"include"!=e.credentials&&"same-origin"!=e.credentials&&(e.credentials="omit"),void 0===e.cache||"no-store"!=e.cache&&"reload"!=e.cache&&"no-cache"!=e.cache&&"force-cache"!=e.cache&&"only-if-cached"!=e.cache&&(e.cache="default"),void 0===e.params&&(e.params={}),"GET"==e.method){e.body=null;var i="";Object.keys(e.params).length&&(i=Core.request.serialize(e.params)),i&&(-1==s.search("[?]")?s+="?":s+="&",s+=i)}else if("DELETE"!=e.method)if("json"==e.contentType)e.headers["Content-Type"]="application/json",e.body=JSON.stringify(e.params);else{"form"==e.contentType&&(e.headers["Content-Type"]="application/x-www-form-urlencoded");var n=new FormData;for(var t in e.params)n.append(t,e.params[t]);e.body=n}Core.debug&&Core.log.printDebug("Core.request.call",e,!0);var a={method:e.method,headers:e.headers};void 0!==e.mode&&(a.mode=e.mode),void 0!==e.cache&&(a.cache=e.cache),void 0!==e.credentials&&(a.credentials=e.credentials),void 0!==e.body&&null!=e.body&&(a.body=e.body),fetch(s,a).then(function(o){return Core.debug&&Core.log.printDebug("Core.request.call returning from: "+s+" and transforming result from: "+e.responseType),"no-cors"==e.mode?o:"json"==e.responseType?o.json():o.text()}).then(function(e){o(e)}).catch(function(e){void 0===e&&(e=""),Core.error.add("[Core.request] fetch("+s+") ",e.message),console.log(e),r({success:!1,errors:["see console"]})})},this.get=function(e,o,r,t){Core.request.call({method:"GET",url:e,responseType:t},o,r)},this.addHeader=function(e,o){Core.debug&&Core.log.printDebug('Core.request.addHeader("'+e+'","'+o+'")'),Core.request.headers[e]=o},this.removeHeader=function(e){Core.debug&&Core.log.printDebug('Core.request.removeHeader("'+e+'")'),delete Core.request.headers[e]},this.resetHeader=function(){Core.debug&&Core.log.printDebug("Core.request.resetHeader()"),Core.request.headers={}}},this.services=new function(){var e={};this.reset=function(o){Core.log.printDebug("Bloombees services: reset."+o),void 0!==e[o]&&(e[o]={config:e[o].config})},this.set=function(o,r){return e[o]=[],void 0===r.url?Core.error.add('Core.services.set("'+o+'",config): missing config["url"].'):void 0===r.method?Core.error.add('Core.services.set("'+o+'",config): missing config["method"].'):(e[o].config=r,void(Core.debug&&Core.log.printDebug('Core.services.set("'+o+'","'+JSON.stringify(r)+'"): done')))},this.bind=function(o,r){return void 0===e[o]?Core.error.add('service.bind("'+o+'",..) does not exist. Use Core.service.set to initialize'):void 0===e[o].config?Core.error.add('service.bind("'+o+'",..) does not exist. Use Core.service.set to initialize'):(Core.debug&&Core.log.printDebug("Binding to '"+o+"':"),void 0===o&&(o="undefined"),void 0===r&&(r=function(e){Core.log.print("Core.services.bind automatic created function: "+o,e)}),void 0===e[o]&&(e[o]=[]),void 0!==e[o].data?(Core.debug&&Core.log.printDebug('service.bind("'+o+'",..) returning data from previous call'),void r(e[o].data)):(void 0===e[o].callbacks&&(e[o].callbacks=[]),e[o].callbacks.push(r),Core.debug&&Core.log.printDebug("Bingding callback"),void(void 0===e[o].function&&(e[o].function=function(r){Core.debug&&Core.log.printDebug("Receiving response from: "+o,"",!0),e[o].data=r;for(var t=e[o].callbacks.length,s=0;s<t;s++)e[o].callbacks[s](r)},Core.request.call(e[o].config,e[o].function)))))}},this.dom=new function(){this.element=function(e){var o=document.getElementById(e);return null==o?(Core.log.print("'"+e+"' does not exist in any 'id' attribute of the dom's elements"),null):o},this.setHTML=function(e,o,r){Core.dom._setHTML(e,o)},this.addHTML=function(e,o){Core.dom._setHTML(e,o,!0)},this._setHTML=function(e,o,r){(element=Core.dom.element(e))&&(element.innerHTML=void 0!==r?element.innerHTML+o:o)}},this.config=new function(){this.config=null,null==this.config&&(body=document.getElementsByTagName("BODY")[0].getAttribute("core-config"))?this.config=JSON.parse(body):this.config={},this.get=function(e){return Core.debug&&Core.log.printDebug('Core.debug.get("'+e+'")',"",!0),void 0===e?Core.config.config:Core.config.config[e]?Core.config.config[e]:null},this.set=function(e,o){return Core.debug&&Core.log.printDebug('Core.debug.set("'+e+'","'+o+'")',"",!0),Core.config.config[e]=o,!0}},this.localize=new function(){this.dics=null,this.lang="en",null==this.dics&&(body=document.getElementsByTagName("BODY")[0].getAttribute("core-localize"))?this.dics=JSON.parse(body):this.dics={},(lang=document.getElementsByTagName("BODY")[0].getAttribute("core-lang"))&&(this.lang=lang),this.get=function(e){return Core.debug&&Core.log.printDebug('Core.localize.get("'+e+'")',"",!0),void 0===e?Core.localize.dics:Core.url.formParams("_debugDics")?e:void 0!==Core.localize.dics[e]?Core.localize.dics[e]:e},this.set=function(e,o){return Core.debug&&Core.log.printDebug('Core.debug.set("'+e+'","'+o+'")',"",!0),Core.localize.dics[e]=o,!0},this.addFromId=function(e){return!(!(element=document.getElementById(e))||!(localize=element.getAttribute("core-localize")))&&Core.localize.add(JSON.parse(localize))},this.add=function(e){Core.debug&&Core.log.printDebug('Core.debug.set("'+JSON.stringify(e)+'","'+value+'")',"",!0);for(k in e)Core.localize.dics[k]=e[k];return!0}},this.user=new function(){this.auth=!1,this.info={},this.cookieVar=null,this.init=function(e){if(!Core.authActive)return void Core.error.add("Core.user.init: Core.authActive is false");if(void 0===e?(Core.debug&&Core.log.printDebug("Core.user.init: using Core.authCookieName ["+Core.authCookieName+"]"),Core.user.cookieVar=Core.authCookieName,e=Core.user.cookieVar):Core.user.cookieVar=e,null==typeof e)return void Core.error.add("Core.user.init: missing cookieVar");Core.debug&&Core.log.printDebug('Core.user.init("'+e+'");');var o=Core.cookies.get(e);if(o){var r=null;(r=Core.cache.get("CloudFrameWorkAuthUser"))?void 0==typeof r.__id||r.__id!=o?(Core.debug&&Core.log.printDebug("Core.user.init: CloudFrameWorkAuthUser {__id:value } DOES NOT MATCH with the value of the cookie "+e+", so... restart"),Core.user.setAuth(!0)):(Core.debug&&Core.log.printDebug("Core.user.init: CloudFrameWorkAuthUser {__id:value} match with the value of the cookie "+e),Core.user.auth=!0,Core.user.info=r):(Core.debug&&Core.log.printDebug("Core.user.init: Generating a CloudFrameWorkAuthUser {__id:value} for cookie "+e),Core.user.setAuth(!0))}else Core.debug&&Core.log.printDebug("Core.user.init: "+e+" cookie does not have any value.. so Core.user.setAuth(false)"),Core.user.auth&&Core.user.setAuth(!1);Core.debug&&Core.log.printDebug("Core.isAuth(): "+Core.user.isAuth())},this.setAuth=function(e){if(cookieVar=Core.user.cookieVar,"undefined"==typeof cookieVar||null==cookieVar)return void Core.error.add("Core.user.setAuth: missing Core.user.cookieVar. Try use Core.init()");if(Core.debug&&Core.log.printDebug("Core.user.setAuth("+e+") for cookie: "+cookieVar),Core.user.info={},Core.user.credentials={},Core.user.auth=!1,Core.cache.set("CloudFrameWorkAuthUser",{}),cookieValue=Core.cookies.get(cookieVar),e){if("undefined"==typeof cookieValue||!cookieValue)return Core.error.add("Core.user.setAuth(true), cookieVar does not exist: "+cookieVar),!1;Core.user.auth=!0,Core.cache.set("CloudFrameWorkAuthUser",{__id:cookieValue}),Core.user.info={__id:cookieValue},Core.debug&&Core.log.printDebug("Core.user.setAuth: saved CloudFrameWorkAuthUser in cache with value "+JSON.stringify(Core.cache.get("CloudFrameWorkAuthUser")))}else"undefined"!=typeof cookieValue&&Core.cookies.remove(cookieVar);return!0},this.isAuth=function(){return 1==Core.user.auth},this.getCookieValue=function(){return Core.user.cookieVar?Core.cookies.get(Core.user.cookieVar):null},this.add=function(e){if("object"!=typeof e)return Core.error.add("Core.user.add(data)","data is not an object"),!1;if(Core.user.isAuth()){for(k in e)Core.user.info[k]=e[k];return Core.cache.set("CloudFrameWorkAuthUser",Core.user.info),!0}return Core.error.add("Core.user.add","Core.user.isAuth() is false"),!1},this.set=function(e,o){return"string"!=typeof e?(Core.error.add("Core.user.set(key,value)","key is not a string"),!1):Core.user.isAuth()?"__id"==e?(Core.error.add("Core.user.set(key,value)","key can not be __id"),!1):(Core.user.info[e]=o,Core.cache.set("CloudFrameWorkAuthUser",Core.user.info),!0):(Core.error.add("Core.user.set(key,value)","Core.user.isAuth() is false"),!1)},this.get=function(e){if(void 0!==e)return Core.user.isAuth()?Core.user.info[e]:(Core.error.add("Core.user.get","Core.user.isAuth() is false"),!1)},this.reset=function(){return Core.user.isAuth()?(Core.user.info={__id:Core.user.info.__id},Core.cache.set("CloudFrameWorkAuthUser",Core.user.info),!0):(Core.error.add("Core.user.set(key,value)","Core.user.isAuth() is false"),!1)}},this.bind=function(e,o,r){void 0!==o&&null!=o||(o=function(e){console.log(e)}),void 0!==r&&null!=r||(r=o);var t=[];"function"==typeof e&&(e=[e]);for(k in e)t[k]=new Promise(e[k]);Promise.all(t).then(function(){o({success:!0})},function(){r({success:!1})})},this.dynamic=new function(){this.urls={},this.load=function(e,o){var r="",t="";if("object"==typeof e&&"object"==typeof e.script&&"string"==typeof e.script.url&&(r=e.script.url),"object"==typeof e&&"object"==typeof e.template&&"string"==typeof e.template.url&&(t=e.template.url),""==r&&""==t)Core.error.add('Core.dynamic.load(data,callback) Missing a right value for data. use {[script:{url:"url"}][,template:{url:"url"}]}'),o();else if(""!=t){var s=function(){""!=r?Core.dynamic.loadScript(e,o):void 0!==o&&o()};Core.dynamic.loadTemplate(e,s)}else Core.dynamic.loadScript(e,o)},this.loadScript=function(e,o){var r="",t="",s="text/javascript",i=document.head;"object"==typeof e.script&&("string"==typeof e.script.url&&(r=e.script.url),"string"==typeof e.script.type&&(s=e.script.type),"string"==typeof e.script.id&&(t=e.script.id),"object"==typeof e.script.dom&&(i=e.script.dom)),""==r?(Core.error.add("Core.dynamic.loadTemplate(data,callback) Missing a right value for data. use {template:url}"),o()):void 0===Core.dynamic.urls[r]?(Core.debug&&Core.log.printDebug('Core.dynamic.loadScript("'+JSON.stringify(e)+'") injecting script'),Core.dynamic.urls[r]=document.createElement("script"),Core.dynamic.urls[r].type=s,""!=t&&(Core.dynamic.urls[r].id=t),Core.dynamic.urls[r].onload=function(e){Core.log.print('Core.dynamic.loadScript("'+r+'") loaded'),void 0===o?Core.log.print(r+" loaded"):o()},Core.dynamic.urls[r].src=r,i.appendChild(Core.dynamic.urls[r])):(Core.debug&&Core.log.printDebug('Core.dynamic.loadScript("'+r+'") already loaded'),void 0!==o&&o())},this.loadTemplate=function(e,o){var r="",t="div",s="",i="",n=document.body;"object"==typeof e.template&&("string"==typeof e.template.url&&(r=e.template.url),"string"==typeof e.template.object&&(t=e.template.object),"string"==typeof e.template.id&&(s=e.template.id),"string"==typeof e.template.type&&(i=e.template.type),"object"==typeof e.template.dom&&(n=e.template.dom)),""==r?(Core.error.add("Core.dynamic.loadTemplate(data,callback) Missing a right value for data. use {template:url}"),o()):void 0===Core.dynamic.urls[r]?(Core.debug&&Core.log.printDebug('Core.dynamic.loadTemplate("'+JSON.stringify(e)+',callback") injecting html'),Core.request.call({method:"GET",url:r,responseType:"html",base:""},function(e){Core.log.print('Core.dynamic.loadTemplate("'+r+'") loaded'),Core.dynamic.urls[r]=document.createElement(t),""!=s&&(Core.dynamic.urls[r].id=s),""!=i&&(Core.dynamic.urls[r].type=i),Core.dynamic.urls[r].innerHTML=e,n.appendChild(Core.dynamic.urls[r]),void 0!==o&&o()})):(Core.debug&&Core.log.printDebug('Core.dynamic.loadTemplate("'+r+'") already loaded'),void 0!==o&&o())}},this.fileInput=function(e,o){var r={length:0,error:!1,errorMsg:"",params:[],files:[]};if("object"==typeof e)if(e.files.length)for(k=0;k<e.files.length;k++)r.params["files["+k+"]"]=e.files[k],r.files[k]={name:e.files[k].name,size:e.files[k].size,type:e.files[k].type,lastModified:e.files[k].lastModified,lastModifiedDate:e.files[k].lastModifiedDate};else r.error=!0,r.errorMsg="Not found files";return r},this.init=function(e,o){Core.debug&&Core.log.printDebug("Core.init("+typeof e+","+typeof o+")"),Core.authActive&&Core.user.init(Core.authCookieName),"function"==typeof e||"array"==typeof e||"object"==typeof e?Core.bind(e,function(e){"function"==typeof o&&o(e)}):"function"==typeof o&&o({success:!0})},this.oauthpopup=function(e){e.windowName=e.windowName||"ConnectWithOAuth",e.windowOptions=e.windowOptions||"location=0,status=0,width=800,height=400",e.callback=e.callback||function(){window.location.reload()};var o=this;console.log(e.path),o._oauthWindow=window.open(e.path,e.windowName,e.windowOptions),o._oauthWindow.focus(),o._oauthInterval=window.setInterval(function(){o._oauthWindow.closed?(window.clearInterval(o._oauthInterval),e.callback()):o._oauthWindow.focus()},1e3)}},Bloombees=new function(){this.version="1.2.8",this.debug=!1,this.apiUrl=Core.config.get("bloombeesApiUrl")||"https://openapi.bloombees.com/h/api",this.oAuthUrl=Core.config.get("bloombeesOAuthUrl")||"https://bloombees.com/h/service/oauth",this.webKey=Core.config.get("bloombeesWebKey")||"Development",this.cookieNameForToken="bbtoken",this.cookieNameForHash="bbhash",this.lang=Core.config.get("bloombeesLang")||"en",this.data={},this.hashActive=!1,this.authActive=!0,this.refreshCacheHours=24,this.clientCountry=Core.config.get("clientCountry"),this.initiated=null,Core.authCookieName=this.cookieNameForToken,Core.authActive=this.authActive,Core.request.base=this.apiUrl,Core.request.key=this.webKey,Core.debug=!1,this.init=function(e){Bloombees.initiated=!1,Core.request.key=Bloombees.webKey,Core.request.token="",Core.authCookieName=Bloombees.cookieNameForToken,Core.authActive=Bloombees.authActive,Core.request.base=Bloombees.apiUrl,Core.request.key=Bloombees.webKey,
Bloombees.clientCountry=Core.config.get("clientCountry");var o=[Bloombees.checkConfigData,Bloombees.checkMarketingParams];Bloombees.authActive&&o.push(Bloombees.checkDSToken),Bloombees.hashActive&&o.push(Bloombees.checkHashCookie),"ZZ"!=Bloombees.clientCountry&&null!=Bloombees.clientCountry||o.push(Bloombees.checkGeoData),Core.init(o,function(o){Bloombees.initiated=!0,o.success||Bloombees.error("Bloombees.init has returned with error"),"function"==typeof e&&e()})},this.waitUntilInit=function(e){function o(){1==Bloombees.initiated?e():setTimeout(o,250)}o()},this.checkConfigData=function(e){if(Bloombees.data.config=Core.cache.get("BloombeesConfigData"),null!=Bloombees.data.config&&"number"==typeof Bloombees.data.config.timestamp&&!Core.url.formParams("_reloadBloombeesCache")){((new Date).getTime()-Bloombees.data.config.timestamp)/36e5>=Bloombees.refreshCacheHours&&(Bloombees.data.config=null,console.log("Refresing cache in Bloombees.data.config"))}null==Bloombees.data.config||Core.url.formParams("_reloadBloombeesCache")?Bloombees.getConfigData(function(o){if(o.success){Bloombees.data.config=o.data;var r=new Date;Bloombees.data.config.timestamp=r.getTime(),Core.cache.set("BloombeesConfigData",Bloombees.data.config)}else Bloombees.data.config={},Bloombees.error("checkConfigData");Bloombees.debug&&Core.log.printDebug("Bloombees.checkConfigData readed from api into Bloombees.data.config"),e()}):(Bloombees.debug&&Core.log.printDebug("Bloombees.checkConfigData readed from cache into Bloombees.data.config"),e())},this.checkDSToken=function(e){Core.user.isAuth()?(Core.request.token=Core.user.getCookieValue(),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.checkDSToken(resolve) Checking the token in : /auth/check/dstoken"),Core.request.call({url:"/auth/check/dstoken",method:"GET"},function(o){o.success?(Core.user.add(o.data),Bloombees.debug&&Core.log.printDebug("Bloombees.checkDSToken(resolve) Token ok: data recovered and Core.request.token assigned")):(Bloombees.debug&&Core.log.printDebug("Bloombees.checkDSToken(resolve) Token error: deleting local credentials"),Core.user.setAuth(!1),Core.data.reset(),Core.request.token=""),e()})):(Bloombees.debug&&Core.log.printDebug("Bloombees.checkDSToken(resolve) Core.isAuth() == false, so.. checking the token is not needed"),Core.cookies.get(Bloombees.cookieNameForToken)&&console.log("cookie still exist"),Core.data.reset(),Core.request.token="",e())},this.refreshDSToken=function(e){Core.user.isAuth()?(Core.request.token=Core.user.getCookieValue(),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.refreshDSToken(resolve) Checking the token in : /auth/check/dstoken?refresh"),Core.request.call({url:"/auth/check/dstoken?refresh",method:"GET"},function(o){o.success?(Core.user.add(o.data),Bloombees.debug&&Core.log.printDebug("Bloombees.refreshDSToken(resolve) Token ok: data recovered and Core.request.token assigned")):(Bloombees.debug&&Core.log.printDebug("Bloombees.checkDSToken(resolve) Token error: deleting local credentials"),Core.user.setAuth(!1),Core.data.reset(),Core.request.token=""),e()})):(Bloombees.debug&&Core.log.printDebug("Bloombees.refreshDSToken(resolve) Core.isAuth() == false, so.. refreshing the token is not needed"),Core.cookies.get(Bloombees.cookieNameForToken)&&console.log("cookie still exist"),Core.data.reset(),Core.request.token="",e())},this.checkHashCookie=function(e){var o=Core.cookies.get(Bloombees.cookieNameForHash);console.log(o),void 0!==o&&o?(Bloombees.debug&&Core.log.printDebug("Bloombees.checkHashCookie(resolve) avoiding call because a hash exists"),e()):(Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.checkHashCookie(resolve) Getting the hash from: /auth/hash"),Core.request.call({url:"/auth/hash",method:"GET"},function(o){o.success?(Core.cookies.set(Bloombees.cookieNameForHash,o.data),Bloombees.debug&&Core.log.printDebug("Bloombees.checkHashCookie(resolve) hash retrieved a hash for: "+Bloombees.cookieNameForHash)):Bloombees.error("Bloombees.checkHashCookie(resolve)",o),e()}))},this.checkMarketingParams=function(e){var o={};if(null!=Core.url.formParams("source")&&(o.source=Core.url.formParams("source")),null!=Core.url.formParams("referrer")&&(o.referrer=Core.url.formParams("referrer")),null!=Core.url.formParams("campaign")&&(o.campaign=Core.url.formParams("campaign")),null!=Core.url.formParams("bbreferral")&&(o.bbreferral=Core.url.formParams("bbreferral")),Bloombees.data.params=Core.cache.get("BloombeesParams"),null!=Bloombees.data.params&&"number"==typeof Bloombees.data.params.timestamp&&!Core.url.formParams("_reloadBloombeesCache")){var r=new Date;(r.getTime()-Bloombees.data.params.timestamp)/36e5>=Bloombees.refreshCacheHours&&(Bloombees.data.params=null,console.log("Refresing cache in Bloombees.data.params"))}if(null==Bloombees.data.params||Core.url.formParams("_reloadBloombeesCache")||Object.keys(o).length){(null==Bloombees.data.params||Core.url.formParams("_reloadBloombeesCache"))&&(Bloombees.data.params={});for(key in o)Bloombees.data.params[key]=o[key];var r=new Date;Bloombees.data.params.timestamp=r.getTime(),Core.cache.set("BloombeesParams",Bloombees.data.params),Bloombees.debug&&Core.log.printDebug("Bloombees.checkMarketingParams read from params into Bloombees.data.params"),e()}else Bloombees.debug&&Core.log.printDebug("Bloombees.checkMarketingParams readed from cache into Bloombees.data.params"),e()},this.checkGeoData=function(e){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.checkGeoData(resolve) Checking the token in : /data/geo"),Core.request.call({url:"/data/geo",method:"GET"},function(o){o.success?(Bloombees.debug&&Core.log.printDebug("Bloombees.checkGeoData(resolve) assigning Bloombees.clientCountry="+o.data.COUNTRY),Bloombees.clientCountry=o.data.COUNTRY):(Bloombees.error("Bloombees.checkGeoData"),console.log(o)),e()})},this.setApiUrl=function(e){Bloombees.debug&&Core.log.printDebug('Bloombees.setApiUrl("'+e+'")'),void 0!==e&&(Bloombees.apiUrl=e,Core.request.base=e,Core.config.set("bloombeesApiUrl",e))},this.setOAuthUrl=function(e){Bloombees.debug&&Core.log.printDebug('Bloombees.setOAuthUrl("'+e+'")'),void 0!==e&&(Bloombees.oAuthUrl=e,Core.config.set("bloombeesOAuthUrl",e))},this.setWebKey=function(e){Bloombees.debug&&Core.log.printDebug('Bloombees.setWebKey("'+e+'")'),void 0!==e&&(Bloombees.webKey=e,Core.request.key=this.webKey,Core.config.set("bloombeesWebKey",e))},this.signInWithOauthPopUp=function(e,o,r){if(void 0===e){var t={success:!1,errors:["Bloombees.signInWithOauthPopUp(social,retUrl,callback) missing social=(facebook|google|instagram)"]};return void 0!==r&&r(t),Bloombees.error("Bloombees.signInWithOauthPopUp(social,retUrl,callback) missing callback")}if(void 0===o||!o.indexOf("{id}")){var t={success:!1,errors:["Bloombees.signInWithOauthPopUp(social, retUrl,callback) missing a right retUrl included '?oauth_id={id}' substring to subtitute it."]};return void 0!==r&&r(t),Bloombees.error('Bloombees.signInWithOauthPopUp(social, retUrl,callback) missing a right retUrl included "?oauth_id={id}" substring to subtitute it.')}Core.oauthpopup({path:Core.config.get("bloombeesOAuthUrl")+"/"+e+"?ret="+o,callback:function(){var e=Core.cookies.get("oauth_id");e?(Core.cookies.remove("oauth_id"),Bloombees.signInWithOauthId(e,function(e){void 0!==r?r(e):console.log(e)})):(t={success:!1,errors:["missing cookie 'oauth_id'. Apply in retUrl the JavaScriptCode to save the cookie oauth_signin"]},void 0!==r?r(t):console.log(t))}})},this.signInWithOauthId=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signInWithOauthId calling: /auth/oauthservice"),Core.request.call({url:"/auth/oauthservice",params:{id:e},method:"POST",contentType:"json"},function(e){e.success?(Core.cookies.set(Bloombees.cookieNameForToken,e.data.dstoken),Core.user.setAuth(!0)?(Core.request.token=Core.user.getCookieValue(),Core.user.add(e.data),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signInWithOauthId added user info: "+JSON.stringify(e.data))):Bloombees.error("Bloombees.signInWithOauthId","Error in Core.user.setAuth(true)")):Bloombees.error("Bloombees.oauth",e),o(e)})},this.signInWithUserPassword=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.login calling: /auth/userpassword"),Core.request.call({url:"/auth/userpassword",params:e,method:"POST",contentType:"json"},function(e){Core.user.isAuth()&&Core.user.setAuth(!1),e.success?(Core.cookies.set(Bloombees.cookieNameForToken,e.data.dstoken),Core.user.setAuth(!0)?(Core.request.token=Core.user.getCookieValue(),Core.user.add(e.data),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.login added user info: "+JSON.stringify(e.data))):Bloombees.error("Bloombees.login","Error in Core.user.setAuth(true)")):Bloombees.error("Bloombees.login",e),o(e)})},this.signUpWithOauthPopUp=function(e,o,r){if(void 0===e){var t={success:!1,errors:["Bloombees.signUpWithOauthPopUp(social,retUrl,callback) missing social=(facebook|google|instagram)"]};return void 0!==r&&r(t),Bloombees.error("Bloombees.signInWithOauth(social,retUrl,callback) missing callback")}if(void 0===o||!o.indexOf("{id}")){var t={success:!1,errors:["Bloombees.signUpWithOauthPopUp(social, retUrl,callback) missing a right retUrl included '?oauth_id={id}' substring to subtitute it."]};return void 0!==r&&r(t),Bloombees.error('Bloombees.signUpWithOauthPopUp(social, retUrl,callback) missing a right retUrl included "?oauth_id={id}" substring to subtitute it.')}Core.oauthpopup({path:Core.config.get("bloombeesOAuthUrl")+"/"+e+"?ret="+o,callback:function(){var e=Core.cookies.get("oauth_id"),o=Core.cookies.get("oauth_emailRequired");Core.cookies.remove("oauth_id"),Core.cookies.remove("oauth_emailRequired"),e?o?(t={success:!1,oauth_id:e,status:4e3,errors:["missing email in the social network. Ask for email and call XXXXX: "]},void 0!==r?r(t):console.log(t)):Bloombees.signUpWithOauthId(e,null,function(e){void 0!==r?r(e):console.log(e)}):(t={success:!1,status:5030,errors:["missing cookie 'oauth_id'. Apply in retUrl the JavaScriptCode to save the cookie oauth_signin"]},void 0!==r?r(t):console.log(t))}})},this.signUpWithOauthId=function(e,o,r){var t={id:e,User_language:Bloombees.lang,dstoken:1};null!=o&&"string"==typeof o&&(t.User_email=o),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.oauth calling: /auth/oauthservice"),Core.request.call({url:"/register/user/oauthservice",params:t,method:"POST",contentType:"json"},function(e){e.success?(Core.cookies.set(Bloombees.cookieNameForToken,e.data.dstoken),Core.user.setAuth(!0)?(Core.request.token=Core.user.getCookieValue(),Core.user.add(e.data),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpWithOauthId added user info: "+JSON.stringify(e.data))):Bloombees.error("Bloombees.oauth","Error in Core.user.setAuth(true)")):Bloombees.error("Bloombees.oauth",e),r(e)})},this.signUpWithUserPassword=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUp calling: /register/user"),Core.request.call({url:"/register/user",params:e,method:"POST",contentType:"json"},function(e){Core.user.isAuth()&&Core.user.setAuth(!1),e.success?void 0!==e.data.dstoken&&(Core.cookies.set(Bloombees.cookieNameForToken,e.data.dstoken),Core.user.setAuth(!0)?(Core.request.token=Core.user.getCookieValue(),Core.user.add(e.data),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpWithUserPassword added user info: "+JSON.stringify(e.data))):Bloombees.error("Bloombees.signUpWithUserPassword","Error in Core.user.setAuth(true)")):Bloombees.error("Bloombees.signUpWithUserPassword",e),o(e)})},this.signUpStore=function(e,o){Core.user.isAuth()||Bloombees.error("Bloombees.signUpStore you are not authenticated"),null!==Core.user.get("Store_uniqueId")&&Bloombees.error("Bloombees.signUpStore the user has already a store created: "+Core.user.get("Store_id")+" - "+Core.user.get("Store_uniqueId")),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpStore calling: /register/store/{User_id}"),Core.request.call({url:"/register/store/"+Core.user.get("User_id"),params:e,method:"POST",contentType:"json"},function(e){e.success?Core.request.call({url:"/auth/check/dstoken?refresh",method:"GET"},function(r){r.success?Core.user.add(r.data):Bloombees.error("Bloombees.signUpPromoter calling to /auth/check/dstoken?refresh",r),o(e)}):(Bloombees.error("Bloombees.signUpStore",e),o(e))})},this.signUpPromoter=function(e,o){Core.user.isAuth()||Bloombees.error("Bloombees.signUpPromoter you are not authenticated"),null!==Core.user.get("Store_id")&&Bloombees.error("Bloombees.signUpPromoter the user has already a store created: "+Core.user.get("Store_id")),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpPromoter calling: /register/beeviral/{User_id}"),Core.request.call({url:"/register/beeviral/"+Core.user.get("User_id"),params:e,method:"POST",contentType:"json"},function(e){e.success?Core.request.call({url:"/auth/check/dstoken?refresh",method:"GET"},function(r){r.success?Core.user.add(r.data):Bloombees.error("Bloombees.signUpPromoter calling to /auth/check/dstoken?refresh",r),o(e)}):(Bloombees.error("Bloombees.signUpPromoter",e),o(e))})},this.signUpReferrer=function(e,o){Core.user.isAuth()||Bloombees.error("Bloombees.signUpReferrer you are not authenticated"),null!==Core.user.get("Store_id")&&Bloombees.error("Bloombees.signUpReferrer the user has already a store created: "+Core.user.get("Store_id")),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpReferrer calling: /register/referrer/{User_id}"),Core.request.call({url:"/register/referrer/"+Core.user.get("User_id"),params:e,method:"POST",contentType:"json"},function(e){e.success?Core.request.call({url:"/auth/check/dstoken?refresh",method:"GET"},function(r){r.success?Core.user.add(r.data):Bloombees.error("Bloombees.signUpReferrer calling to /auth/check/dstoken?refresh",r),o(e)}):(Bloombees.error("Bloombees.signUpReferrer",e),o(e))})},this.signUpCodeAvailability=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpCodeAvailability calling: /register/availability/code/{code}"),Core.request.call({url:"/register/availability/code/"+e,method:"GET"},function(e){o(e)})},this.signUpUniqueIdAvailability=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.signUpUniqueIdAvailability calling: /register/availability/store/{unique_id}"),Core.request.call({url:"/register/availability/store/"+e,method:"GET"},function(e){o(e)})},this.confirmEmail=function(e,o){Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.confirmEmail calling: /auth/confirm"),Core.request.call({url:"/auth/confirm",params:e,method:"POST",contentType:"json"},function(e){e.success?Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.confirmEmail confirmed for user. Info: "+JSON.stringify(e.data)):Bloombees.error("Bloombees.confirmEmail",e),o(e)})},this.isAuth=function(){return!0===Core.user.isAuth()},this.logOut=function(e){Core.user.isAuth()?Core.request.call({url:"/auth/deactivate/dstoken",method:"PUT"},function(o){o.success&&Bloombees.debug&&console.log("Token deleted"),Core.user.setAuth(!1),Core.data.reset(),Core.request.token="",void 0!==e&&e()}):(Core.data.reset(),Core.request.token="",void 0!==e&&e())},this.getToken=function(){return Core.cookies.get(Bloombees.cookieNameForToken)||""},this.getHash=function(){return Core.cookies.get(Bloombees.cookieNameForHash)||""},this.getConfigData=function(e,o){var r=Core.data.get("getConfigData");void 0===r||o?(Core.data.set("getConfigData",{success:!1}),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getConfigData calling: /data/info"),Core.request.call({url:"/data/info",method:"GET"},function(o){o.success&&(Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getConfigData added info: Core.data.set('getConfigData',response);"),Core.data.set("getConfigData",o)),e(o)})):e(r)},this.getUserData=function(e,o){if("function"!=typeof e&&(e=function(e){console.log(e)}),!Bloombees.isAuth())return Bloombees.error("Bloombees.getUserData","user is not authenticated."),void e({success:!1,error:["User is not authenticated in the frontend. Avoiding call"]});var r=Core.data.get("getUserData");void 0===r||o?(Core.data.set("getUserData",{success:!1}),Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getUserData calling: /manage/users/"+Core.user.get("User_id")),Core.request.call({url:"/manage/users/"+Core.user.get("User_id"),method:"GET"},function(o){o.success&&(Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getUserData added info: Core.data.set('getUserData',response);"),Core.data.set("getUserData",o)),e(o)})):e(r)},this.getUserSocialNetworks=function(e,o){if(!Bloombees.isAuth())return Bloombees.error("Bloombees.getUserSocialNetworks","user is not authenticated."),void e({success:!1,error:["User is not authenticated in the frontend. Avoiding call"]});var r=Core.data.get("getUserSocialNetworks");void 0===r||o?(Core.data.set("getUserSocialNetworks",{success:!1}),Core.request.call({url:"/socialnetworks/connections/"+Core.user.get("User_id"),method:"GET"},function(o){o.success&&Core.data.set("getUserSocialNetworks",o),e(o)})):e(r)},this.getHTMLVersionOfTermsAndConditions=function(e,o,r){if("string"!=typeof e)return Bloombees.error("Bloombees.getHTMLVersionOfTermsAndConditions","version is not a string."),void o("error loading terms.");var t=Core.data.get("getHTMLVersionOfTermsAndConditions");void 0===t||r?(Core.data.set("getHTMLVersionOfTermsAndConditions_"+e,null),Core.request.call({url:"/legal/tac/versions/"+e,method:"GET",responseType:"html"},function(r){Core.data.set("getHTMLVersionOfTermsAndConditions_"+e,r),o(r)})):o(t)},this.connectUserSocialNetwork=function(e,o){if(!Bloombees.isAuth())return Bloombees.error("Bloombees.getUserSocialNetworks","user is not auth end."),void o({success:!1,error:["User is not auth in the frontend. Avoiding call"]});Core.request.call({url:"/socialnetworks/connections/"+Core.user.get("User_id")+"/oauthservice",params:{id:e},method:"POST",contentType:"json"},function(e){o(e)})},this.disconnectUserSocialNetwork=function(e,o){if(!Bloombees.isAuth())return Bloombees.error("Bloombees.getUserSocialNetworks","user is not auth end."),void o({success:!1,error:["User is not auth in the frontend. Avoiding call"]});Core.request.call({url:"/socialnetworks/connections/"+Core.user.get("User_id")+"/"+e,method:"DELETE"},function(e){o(e)})},this.callMeNow=function(e,o){return void 0===e.Contact_name?Bloombees.error("Bloombees.callMeNow missing Contact_name"):void 0===e.Contact_phone?Bloombees.error("Bloombees.callMeNow missing Contact_phone"):void 0===e.Contact_sourceType?Bloombees.error("Bloombees.callMeNow missing Contact_sourceType"):void 0===e.Contact_sourceSection?Bloombees.error("Bloombees.callMeNow missing Contact_sourceSection"):void 0===e.Contact_lang?Bloombees.error("Bloombees.callMeNow missing Contact_lang"):(Core.debug=!0,void Core.request.call({url:"/forms/callmenow",method:"POST",params:e,contentType:"json"},function(e){o(e)}))},this.getUserTermsAndConditions=function(e,o){if(!Bloombees.isAuth())return Bloombees.error("Bloombees.getUserTermsAndConditions","user is not authenticated."),void e({success:!1,error:["User is not authenticated in the frontend. Avoiding call"]});var r=Core.data.get("getUserTermsAndConditions");void 0===r||o?(Core.data.set("getUserTermsAndConditions",{success:!1}),Core.request.call({url:"/auth/terms/"+Core.user.get("User_id"),method:"GET"},function(o){o.success&&Core.data.set("getUserTermsAndConditions",o),e(o)})):e(r)},this.getLinkToUploadImages=function(e,o){var r="";switch(e){case"signuplogo":Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getLinkToUploadFiles calling: /upload/users/{user_id}/logo"),r="/upload/users/"+Core.user.get("User_id")+"/logo";break;case"logo":if(!Bloombees.isAuth())return o({success:!1,errors:["to upload a logo, it requires to be authenticated"]}),Bloombees.error("to upload a logo, it requires to be authenticated");if(!Core.user.get("Store_id"))return o({success:!1,errors:["to upload product images, it requires to be a promoter or a seller"]}),Bloombees.error("to upload product images, it requires to be a promoter or a seller");Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getLinkToUploadFiles calling: /upload/stores/{store_id}/logo"),r="/upload/stores/"+Core.user.get("Store_id")+"/logo";break;case"product":if(!Bloombees.isAuth())return o({success:!1,errors:["to upload product images, it requires to be authenticated"]}),Bloombees.error("to upload product images, it requires to be authenticated");if(!Core.user.get("Store_id"))return o({success:!1,errors:["to upload product images, it requires to be a promoter or a seller"]}),Bloombees.error("to upload product images, it requires to be a promoter or a seller");Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getLinkToUploadFiles calling: /upload/stores/{store_id}/products"),r="/upload/stores/"+Core.user.get("Store_id")+"/products";break;case"picture":if(!Bloombees.isAuth())return o({success:!1,errors:["to upload user picture, it requires to be authenticated"]}),Bloombees.error("to upload user picture, it requires to be authenticated");Bloombees.debug&&!Core.debug&&Core.log.printDebug("Bloombees.getLinkToUploadFiles calling: /upload/users/{user_id}/image"),r="/upload/users/"+Core.user.get("User_id")+"/image";break;default:return o({success:!1,errors:["wrong type. Use getLinkToUploadImages('(logo|product|picture)'])"]}),Bloombees.error("wrong type. Use getLinkToUploadImages('(logo|product|picture)'])")}Core.request.call({url:r,method:"GET",credentials:"include"},function(e){o(e)})},this.uploadImage=function(e,o,r){var t=Core.fileInput(o);if(t.error)return Core.error.add(t.errorMsg);if(console.log(t),void 0===t||void 0===t.files||void 0===t.files[0].type||0!=t.files[0].type.indexOf("image/"))return r({success:!1,errors:["you only can upload images"]}),Bloombees.error("You can only upload images");switch(e){case"signuplogo":break;case"logo":if(!Bloombees.isAuth())return r({success:!1,errors:["to upload a logo, it requires to be authenticated"]}),Bloombees.error("Bloombees.uploadFile upload a logo requires to be authenticated");if(!Core.user.get("Store_id"))return r({success:!1,errors:["to upload product images, it requires to be a promoter or a seller"]}),Bloombees.error("Bloombees.uploadFile upload product images require to be a promoter or a seller");break;case"product":if(!Bloombees.isAuth())return r({success:!1,errors:["to upload product images, it requires to be authenticated"]}),Bloombees.error("Bloombees.uploadFile upload product images requires to be authenticated");if(!Core.user.get("Store_id"))return r({success:!1,errors:["to upload product images, it requires to be a promoter or a seller"]}),Bloombees.error("Bloombees.uploadFile upload product images requires to be a promoter or a seller");break;case"picture":if(!Bloombees.isAuth())return r({success:!1,errors:["to upload user picture, it requires to be authenticated"]}),Bloombees.error("Bloombees.uploadFile upload user picture requires to be authenticated");break;default:return r({success:!1,errors:["wrong type. Use getLinkToUploadImages('(logo|product|picture)'])"]}),Bloombees.error("wrong type. Use getLinkToUploadImages('(logo|product|picture)'])")}Bloombees.getLinkToUploadImages(e,function(e){if(e.success){var o=e.data.uploadUrl;console.log(o,t.params),Core.request.call({method:"POST",url:o,credentials:"include",params:t.params},function(e){r(e)})}else console.log(e),r(e)})},this.acceptUserTermsAndConditions=function(e,o){return"string"!=typeof e?(Bloombees.error("Bloombees.acceptUserTermsAndConditions","version is not a string."),void o({success:!1,error:["Bloombees.acceptUserTermsAndConditions","version is not a string."]})):Bloombees.isAuth()?(Core.debug=!0,void Core.request.call({url:"/auth/terms/"+Core.user.get("User_id"),method:"POST",params:{User_termsId:e}},function(e){o(e)})):(Bloombees.error("Bloombees.acceptUserTermsAndConditions","user is not authenticated."),void o({success:!1,error:["User is not authenticated in the frontend. Avoiding call"]}))},this.checkPasswordRecovery=function(e,o){if("string"!=typeof e)return Bloombees.error("Bloombees.checkPasswordRecovery","email is not a string."),void o({success:!1,error:["Bloombees.sendPasswordRecovery","email is not a string."]});Core.request.call({url:"/auth/newpassword",method:"GET",params:{id:e}},function(e){o(e)})},this.updatePasswordRecovery=function(e,o){Core.request.call({url:"/auth/newpassword",method:"PUT",contentType:"json",params:e},function(e){o(e)})},this.generatePasswordRecovery=function(e,o){if("string"!=typeof e)return Bloombees.error("Bloombees.generatePasswordRecovery","email is not a string."),void o({success:!1,error:["Bloombees.generatePasswordRecovery","email is not a string."]});Core.request.call({url:"/auth/newpassword",method:"POST",params:{User_email:e}},function(e){o(e)})},this.error=function(e,o){"string"==typeof e&&(e="[Bloombees.error] "+e),void 0!==o?console.log(e,o):console.log(e)}};